
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Herp Derp</title>

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="class.js"></script>
    <script src="entity.js"></script>
    <script src="vector.js"></script>
    <script src="animation.js"></script>
    <script src="matrix.js"></script>
    <script src="bone.js"></script>
    <script src="inputHandler.js"></script>
    <script src="primitive.js"></script>
    <script src="mesh.js"></script>
    <script src="renderManager.js"></script>
    <script src="p3_dude.js"></script>
  
</head>
<body>
    <canvas id="canvas" style="position:absolute;"></canvas>
    <div id="containerDiv" align="center">
        <center>
            Use WASD to move the camera's location, and click into the <br>
            canvas or use the arrow keys to change the camera orientation.<br>
            Space and control move up and down.
        </center>
    </div>
  



<script type='text/javascript'>//<![CDATA[

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext('2d');
var projection = new Matrix();
var renderManager = new RenderManager(ctx, canvas.width, canvas.height);
function resizeCallback() {
    canvas.width = document.documentElement.clientWidth - 10;
    canvas.height = document.documentElement.clientHeight - 10;
    renderManager.width = canvas.width;
    renderManager.height = canvas.height;
    projection = MatrixCreateProjection(Math.PI/2, canvas.width / canvas.height, 1, 20);
}
resizeCallback();
$(window).resize(function() {
    resizeCallback();
})
var mouseDiff = {x: 0, y: 0};
function moveCallback(x, y) {
    mouseDiff.x += x;
    mouseDiff.y += y;
}
initMouseHandling($("#canvas"), moveCallback);

var prev_timestamp = 0;
var cameraPosition = new Vector(6, 0, 6);
var theta = -3 * Math.PI/4;
var phi = 0;
var moveSpeed = 10;
var cameraSensitivity = 1;
var moveDir = new Vector();
var mouseSensitivity = 1 / 100;
var dude = Dude();
function loop(timestamp) {
    var delta = 0;
    if (prev_timestamp > 0) delta = (timestamp - prev_timestamp) / 1000;
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    moveDir = new Vector();
    if(keyboardState[87]) moveDir.z += 1;
    if(keyboardState[83]) moveDir.z -= 1;
    if(keyboardState[68]) moveDir.x += 1;
    if(keyboardState[65]) moveDir.x -= 1;
    if(keyboardState[32]) moveDir.y += 1;
    if(keyboardState[17]) moveDir.y -= 1;
    if(keyboardState[38]) phi += cameraSensitivity * delta;
    if(keyboardState[40]) phi -= cameraSensitivity * delta;
    if(keyboardState[37]) theta -= cameraSensitivity * delta;
    if(keyboardState[39]) theta += cameraSensitivity * delta;

    moveDir = Matrix.CreateRotationYPR(theta, 0, 0).transform(moveDir);
    cameraPosition = cameraPosition.add(moveDir.mul(moveSpeed * delta));

    theta += mouseDiff.x * mouseSensitivity;
    phi += mouseDiff.y * mouseSensitivity;
    if(theta > Math.PI * 2) theta -= Math.PI * 2;
    var view = MatrixCreateView(theta, phi, cameraPosition);
    //var view = MatrixCreateView(Math.PI / 2,0, new Vector(-400,0,200));
    var viewProjection = projection.mul(view);
    dude.update(delta);
    dude.draw(renderManager);
    renderManager.draw(viewProjection);
    prev_timestamp = timestamp;
    mouseDiff = {x: 0, y: 0};
    window.requestAnimationFrame(loop);
}
loop(0);
//]]> 

</script>

</html>


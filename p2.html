
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Walker (559 P2)</title>

    <script src="vector.js"></script>
    <script src="animation.js"></script>
    <script src="matrix.js"></script>
    <script src="bone.js"></script>
  
</head>
<body>
    <div id="containerDiv" align="center">
        <canvas id="canvas"></canvas>
    </div>
  



<script type='text/javascript'>//<![CDATA[

var canvas = document.getElementById("canvas");
canvas.width = 400;
canvas.height = 200;
var ctx = canvas.getContext('2d');

RectBone = function(name, parent, color, x, y, w, h) {
    Bone.apply(this, [name, parent]);
    this.color = color;
    this.x = x;
    this.y = y;
    this.w = w;
    this.h = h;
}

chest = new RectBone("chest", null, "red", -15, -20, 30, 40);
head = new RectBone("head", chest, "orange", -10,-10,20,20);
leftThigh = new RectBone("leftThigh", chest, "blue", -10, 0,20,25);
rightThigh = new RectBone("rightThigh", chest, "blue", -10, 0,20,25);
leftCalf = new RectBone("leftCalf", leftThigh, "green", -10, 0,20,25);
rightCalf = new RectBone("rightCalf", rightThigh, "green", -10, 0,20,25);

anim = new Animation(chest);
anim.addKeyFrame(0, "chest", MatrixCreateTranslation(0,100,0));
anim.addKeyFrame(0, "head", MatrixCreateTranslation(0,-30,0));
function insertLegFrames(t) {
    anim.addKeyFrame(t + 0, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/4)));
    anim.addKeyFrame(t + 0, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/4)));
    anim.addKeyFrame(t + 0, "leftCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 0, "rightCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/8)));

    anim.addKeyFrame(t + 1, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/8)));
    anim.addKeyFrame(t + 1, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/8)));

    anim.addKeyFrame(t + 2, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 2, "leftCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 2, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 2, "rightCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/2)));

    anim.addKeyFrame(t + 3, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/8)));
    anim.addKeyFrame(t + 3, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/8)));
    anim.addKeyFrame(t + 3, "rightCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/4)));

    anim.addKeyFrame(t + 4, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/4)));
    anim.addKeyFrame(t + 4, "leftCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0, Math.PI/8)));
    anim.addKeyFrame(t + 4, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/4)));
    anim.addKeyFrame(t + 4, "rightCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));

    anim.addKeyFrame(t + 5, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/8)));
    anim.addKeyFrame(t + 5, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/8)));

    anim.addKeyFrame(t + 6, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 6, "rightCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 6, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
    anim.addKeyFrame(t + 6, "leftCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/2)));

    anim.addKeyFrame(t + 7, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/8)));
    anim.addKeyFrame(t + 7, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/8)));
    anim.addKeyFrame(t + 7, "leftCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/4)));

    anim.addKeyFrame(t + 8, "rightThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,Math.PI/4)));
    anim.addKeyFrame(t + 8, "rightCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0, Math.PI/8)));
    anim.addKeyFrame(t + 8, "leftThigh", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,-Math.PI/4)));
    anim.addKeyFrame(t + 8, "leftCalf", MatrixCreateTranslation(0, 20, 0).mul(MatrixCreateRotationYPR(0,0,0)));
}
insertLegFrames(0);
insertLegFrames(8);
insertLegFrames(16);
insertLegFrames(24);


anim.addKeyFrame(32, "chest", MatrixCreateTranslation(400,100,0));

ctx.clearRect(0, 0, canvas.width, canvas.height);

var prev_timestamp = 0;

function loop(timestamp) {
    var delta = 0;
    if (prev_timestamp > 0) delta = timestamp - prev_timestamp;
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    anim.update(delta / 150);
    for(var key in chest.bones) {
        var bone = chest.bones[key];
        var transform = bone.withParentTransform();
        ctx.setTransform(transform.values[0][0], transform.values[0][1], transform.values[1][0], 
            transform.values[1][1], transform.values[3][0], transform.values[3][1]);
        ctx.fillStyle = bone.color;
        ctx.fillRect(bone.x, bone.y, bone.w, bone.h);
    }
    prev_timestamp = timestamp;
    window.requestAnimationFrame(loop);
}
loop(0);
//]]> 

</script>

</html>

